<!DOCTYPE html>
<html lang="fr" itemscope itemtype="http://schema.org/Blog">
	<head>
		<meta charset="utf-8" />
		<title>“T’as le look, Cocoa”</title>
		
		<link rel="stylesheet" type="text/css" href="../style/main.css?quote"/>
		<link rel="stylesheet" type="text/css" href="../style/main-large.css" media="all and (min-device-width:800px)"/>
		
		<link rel="shortcut icon" href="../img/vt-16.png" />
		<link rel="apple-touch-icon-precomposed" href="../img/vt-114.png" />
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../img/vt-72.png" />
		
		<link href='http://fonts.googleapis.com/css?family=Nunito:300,700' rel='stylesheet' type='text/css'>
		<link href="feed.xml" type="application/atom+xml" rel="alternate" title="Blog (Atom)" />
		<meta name="viewport" content="width=device-width, user-scalable=no" />
		<meta itemprop="image" content="http://www.vtourraine.net/blog/img/ios-cocoa-custom-style/drawrect.png">
		
		<!--[if lte IE 8]>
		<script src="../script/html5ie.js" type="text/javascript"></script>
		<![endif]-->
		
		<script type="text/javascript">
		  window.___gcfg = {lang: 'fr'};
		
		  (function() {
		    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
		    po.src = 'https://apis.google.com/js/plusone.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
		  })();
		</script>
		<script type="text/javascript">
		
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-18279263-3']);
		  _gaq.push(['_trackPageview']);
		
		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		
		</script>
	</head>
	<body class="post">
		<header>
			<h1>
				<a class="headline" href="../"><span>Vincent Tourraine</span></a>
				<span id="main"><a href="./"><span class="icon"><img src="../style/img/notepad-28-2x.png" alt="" /></span> <span>Blog</span></a></span>
			</h1>
		</header>
		<section class="post">
			<h1 itemprop="name">“T’as le look, Cocoa”</h1>
			<div class="meta"><time datetime="2013-03-08T16:40:16+01:00"> 8 March 2013</time>, <a class="tag" href="../blog/tags/ios">#iOS</a> <a class="tag" href="../blog/tags/uikit">#UIKit</a> <a class="tag" href="../blog/tags/cocoa">#Cocoa</a> <a class="tag" href="../blog/tags/style">#style</a></div>
			<div itemprop="description" class="description">UIKit est votre ami. Si vous connaissez le développement iOS, vous maîtrisez déjà la plupart des éléments graphiques proposés par UIKit. Cette palette vous permet de construire rapidement une interface, à l’aide d’éléments standards, prêts à l’emploi. Comment faire alors pour personnaliser cette interface, pour rendre votre application unique et reconnaissable ?</div>
			<div class="content"><h2>UIKit</h2>

<p>
  La première solution consiste tout simplement à utiliser les propriétés mises à disposition par UIKit. <code>tintColor</code>, <code>backgroundImage</code>, <code>font</code>, autant d’occasions de modifier l'apparence des vues concernées. Il vous suffit de regarder la documentation de l’élément concerné pour connaître les propriétés à votre disposition. En utilisant Interface Builder, vous trouverez tout ça dans l’inspecteur.
</p>

<p>
  Si ces modifications doivent s’appliquer de façon identique à toutes les instances d'un élément d'interface (exemple classique : modifier la <code>tintColor</code> de toutes les <code>UINavigationBar</code> de votre application), vous avez tout intérêt à utiliser le protocole <code>UIAppearance</code> disponible depuis iOS 5. En une seule ligne de code, vous appliquez ainsi une valeur à toutes les instances d’une classe, présentes et à venir.
</p>

<p>
  Pour reprendre l’exemple de la barre de navigation :
</p>

<code>
  [[UINavigationBar appearance] setTintColor:[UIColor greenColor]];
</code>

<p>
  Besoin de contextualiser une valeur ? Vous pouvez alors préciser un “contenant”. On peut par exemple utiliser une couleur différente selon qu’un <code>UIBarButtonItem</code> se trouve dans une <code>UINavigationBar</code> ou une <code>UIToolbar</code>.
</p>

<code>
  [[UIBarButtonItem appearanceWhenContainedIn:[UINavigationBar class], nil] setTintColor:[UIColor blackColor]];<br/>
  [[UIBarButtonItem appearanceWhenContainedIn:[UIToolbar class], nil] setTintColor:[UIColor redColor]];
</code>

<div class="slideshow">
	<img src="img/ios-cocoa-custom-style/appearance-barbuttonitem.png" alt="UIBarButtonItems" class="nostyle" />
</div>

<p>
  Et pour encore plus de précision, ces définitions ne vous empêchent pas de modifier ponctuellement les propriétés concernées pour une instance donnée, de façon classique.
</p>

<p>
  Documentation : <a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UIAppearance_Protocol/Reference/Reference.html">UIAppearance Protocol Reference</a>
</p>

<p>
  Ces solutions sont sûrement les plus simples, et souvent les meilleures. Mais ce n’est pas toujours suffisant. Il existe notamment des propriétés moins explicites, un peu cachées, qui sont pourtant très utiles pour personnaliser rapidement un élément UIKit.
</p>

<h2>CALayer</h2>

<p>
  Toutes les vues disposent d’une propriété <code>layer</code>, de type <code>CALayer</code>, qui entre en jeu lors du rendu à l’écran (vaste sujet). Ce layer est en lecture seule, mais vous pouvez le customiser très facilement. Besoin d’ajouter une ombre portée autour de votre vue ? Pas de problème. Une bordure pour marquer les contours ? Facile. Avec des coins arrondis ? Trivial. Importez simplement le framework QuartzCore, et à vous de jouer.
</p>

<code>
#import &lt;QuartzCore/QuartzCore.h&gt;<br/>
<br/>
(...)<br/>
<br/>
UIView *view1 = (...);<br/>
<br/>
view1.layer.borderWidth = 4;<br/>
view1.layer.borderColor = [UIColor blackColor].CGColor;<br/>
view1.layer.cornerRadius = 20;<br/>
<br/>
UIView *view2 = (...);<br/>
<br/>
view2.layer.shadowRadius = 10;<br/>
view2.layer.shadowColor = [UIColor blackColor].CGColor;<br/>
view2.layer.shadowOpacity = 0.8;
</code>

<div class="slideshow">
	<img src="img/ios-cocoa-custom-style/calayer.png" alt="CALayers" class="nostyle" />
</div>

<p>
  Petit bémol, vous ne pouvez pas utiliser l’ombre portée et les coins arrondis d’un <code>CALayer</code> en même temps. En effet, les coins ont besoin du clipping (<code>view.clipToBounds = YES</code>) pour masquer la partie extérieure du coin, alors que l’ombre a besoin au contraire de désactiver le clipping pour se dessiner autour de la vue elle-même. Vous pouvez vous en sortir en imbriquant deux layers, ou trouver une solution complémentaire. Ou encore limiter l’utilisation de ce genre de décorations (un peu ça va, beaucoup bonjour les dégâts).
</p>

<p>
  Documentation : <a href="http://developer.apple.com/library/ios/#documentation/GraphicsImaging/Reference/CALayer_class/Introduction/Introduction.html#//apple_ref/doc/c_ref/CALayer">CALayer Class Reference</a>
</p>

<h2>UIImage</h2>

<p>
  Créer une <code>UIImage</code> à partir d’un fichier .jpg ou .png, rien de plus facile. Imaginons que vous souhaitiez utiliser une image de fond pour un bouton, dont vous ne connaissez pas a priori les dimensions. On peut alors utiliser une image étirable, qui s'adaptera automatiquement aux dimensions de la vue concernée. Il suffit de préciser la taille de la zone redimensionnable, et choisir entre étirer ou bien répéter le contenu de l’image.
</p>

<code>
UIImage *image = ...;<br/>
UIEdgeInsets insets = UIEdgeInsetsMake(30, 30, 30, 30);<br/>
<br/>
UIImageView *imageView1 = ...;<br/>
imageView1.image = [image resizableImageWithCapInsets:insets resizingMode:UIImageResizingModeStretch];<br/>
<br/>
UIImageView *imageView2 = ...;<br/>
imageView2.image = [image resizableImageWithCapInsets:insets resizingMode:UIImageResizingModeTile];
</code>

<div class="slideshow">
	<img src="img/ios-cocoa-custom-style/resizable.png" alt="Resizable images" class="nostyle" />
</div>

<p>
  Documentation : <a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UIImage_Class/Reference/Reference.html">UIImage Class Reference</a>
</p>

<h2>UIColor</h2>

<p>
  Certains éléments d’UIKit ne permettent pas d’utiliser directement une image. Comment appliquer une texture de fond à une <code>UIView</code> qui ne propose que backgroundColor ? Il suffit de créer une couleur à partir d’une image. C’est un peu surprenant, mais très efficace, surtout pour des textures.
</p>

<code>
UIImage *image = ...<br/>
UIView *view = ...<br/>
<br/>
view.backgroundColor = [UIColor colorWithPatternImage:image];
</code>

<div class="slideshow">
	<img src="img/ios-cocoa-custom-style/pattern.png" alt="Pattern images" class="nostyle" />
</div>

<p>
  Documentation : <a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UIColor_Class/Reference/Reference.html">UIColor Class Reference</a>
</p>

<h2>Core Graphics à la rescousse</h2>

<p>
  Lorsque les composants d’UIKit ne suffisent pas à obtenir l’effet recherché, il existe une solution imparable : tout faire soi-même, à grands coups de Core Graphics. 
</p>

<p>
  Toutes les vues de votre application possèdent une méthode <code>drawRect:</code> qui sert à se dessiner au sein d’un “contexte graphique”. C’est ce qui permet à la vue d’exister visuellement. Il ne faut jamais appeler cette méthode directement, et vous avez rarement besoin de la définir vous-même.
</p>
<p>
  À ce niveau, tout est permis. Tout est fastidieux, aussi, parce qu’il vous faudra prendre en charge chaque étape de la représentation de votre vue. Pour faciliter un peu les choses, et rendre le code plus lisible, vous pouvez compter sur <code>UIBezierPath</code>. Comme son nom l’indique, il s’agit de dessiner des courbes de <a href="http://fr.wikipedia.org/wiki/Pierre_Bézier">Pierre Bézier</a>. C’est aussi un ensemble de méthodes qui facilitent grandement la construction des formes élémentaires. Voyons un exemple d’utilisation :
</p>

<code>
-  (void)drawRect:(CGRect)rect<br/>
{<br/>
&nbsp;&nbsp;[[UIColor blackColor] setStroke];<br/>
&nbsp;&nbsp;[[UIColor orangeColor] setFill];<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;UIBezierPath *backgroundPath = [UIBezierPath bezierPathWithRoundedRect:CGRectInset(rect, 10, 10) cornerRadius:20];<br/>
&nbsp;&nbsp;[backgroundPath fill];<br/>
&nbsp;&nbsp;[backgroundPath setLineWidth:10];<br/>
&nbsp;&nbsp;float dashPattern[] = {100, 20};<br/>
&nbsp;&nbsp;[backgroundPath setLineDash:dashPattern count:2 phase:0];<br/>
&nbsp;&nbsp;[backgroundPath stroke];<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;UIBezierPath *circlePath = [UIBezierPath bezierPathWithOvalInRect:CGRectInset(rect, 50, 50)];<br/>
&nbsp;&nbsp;[circlePath setLineWidth:5];<br/>
&nbsp;&nbsp;[circlePath stroke];<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;UIBezierPath *zPath = [UIBezierPath bezierPath];<br/>
&nbsp;&nbsp;[zPath moveToPoint:CGPointMake(100, 80)];<br/>
&nbsp;&nbsp;[zPath addLineToPoint:CGPointMake(130, 140)];<br/>
&nbsp;&nbsp;[zPath addLineToPoint:CGPointMake(240, 100)];<br/>
&nbsp;&nbsp;[zPath setLineWidth:15];<br/>
&nbsp;&nbsp;[[UIColor purpleColor] setStroke];<br/>
&nbsp;&nbsp;[zPath stroke];<br/>
}
</code>

<div class="slideshow">
	<img src="img/ios-cocoa-custom-style/drawrect.png" alt="Draw rect" class="nostyle" />
</div>

<p>
  Beaucoup de code pour un résultat esthétiquement discutable, mais tout ça réalisé avec une seule vue, et de la façon la plus optimisée qui soit. Encore une fois, je ne vais pas détailler l’ensemble des méthodes proposées par <code>UIBezierPath</code>, je vous laisse explorer la documentation.
</p>

<p>
  Documentation : <a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UIBezierPath_class/Reference/Reference.html">UIBezierPath Class Reference</a>
</p>

<p>
  Oh, et si ce genre de code vous paraît vraiment trop pénible à produire, sachez qu’il existe au moins une application pour créer des vues avec un éditeur de dessin vectoriel, qui s’occupe justement de générer le code Core Graphics correspondant. Ça s’appelle <a href="http://www.paintcodeapp.com">PaintCode</a>, et ça coûte un peu cher, mais vous pouvez par exemple l’offrir à votre collègue graphiste.
</p>

<h2>Conclusion</h2>

<p>
  J’espère que ces quelques pistes vous aideront à personnaliser vos apps de façon efficace.
</p>
<p>
  On peut passer des heures à mettre péniblement en place une interface, ou connaître la méthode magique qui permet de faire la même chose en une simple ligne de code. Comme souvent, la documentation officielle est votre amie. Et n’oubliez pas que la seule chose pire qu’une interface non customisée, c’est une interface mal customisée.
</p></div>
			<div class="share">
				<a href="https://twitter.com/share" class="twitter-share-button" data-text="&quot;“T’as le look, Cocoa”&quot; par @vtourraine" data-count="horizontal" data-lang="fr">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
				<div class="g-plusone" data-size="medium" ></div>	
				<a href="https://plus.google.com/u/0/117326560329576507699/posts" class="profile" rel="author me">Google+</a>
			</div>
			<div class="comments">
				<div id="disqus_thread"></div>
				<script type="text/javascript">
				    var disqus_shortname = 'vtourraine';
				
				    (function() {
				        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
				        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
				    })();
				</script>
				<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
				<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
			</div>
		</section>
		
		<section>
			<div>
				<div class="postprevious">
					<a href="http://www.vtourraine.net/blog/2012-bilan"><span>← Billet précédent</span><br/>Petit bilan personnel de l’année 2012</a>
				</div>
				<div class="postnext">
					<a href="http://www.vtourraine.net/blog/osx-ios-tests-unitaires-travis"><span>Billet suivant →</span><br />Intégration continue OS X et iOS avec Travis CI</a>
				</div>
			</div>
		</section>
		<footer>
			<nav>
				<a href="../">Vincent Tourraine</a> / <a href="../projects/">Projets</a> / <a href="./"><span>Blog</span></a>
			</nav>
			<div id="mail">
				<a href="mailto:me@vtourraine.net">me@vtourraine.net</a>
			</div>
		</footer>
	</body>
</html>