<!DOCTYPE html>
<html lang="fr" itemscope itemtype="http://schema.org/Blog">
	<head>
		<meta charset="utf-8" />
		<title>iOS : Extraire un compte Twitter du carnet d’adresses</title>
		
		<link rel="stylesheet" type="text/css" href="../style/main.css?quote"/>
		<link rel="stylesheet" type="text/css" href="../style/main-large.css" media="all and (min-device-width:800px)"/>
		
		<link rel="shortcut icon" href="../img/vt-16.png" />
		<link rel="apple-touch-icon-precomposed" href="../img/vt-114.png" />
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../img/vt-72.png" />
		
		<link href='http://fonts.googleapis.com/css?family=Nunito:300,700' rel='stylesheet' type='text/css'>
		<link href="feed.xml" type="application/atom+xml" rel="alternate" title="Blog (Atom)" />
		<meta name="viewport" content="width=device-width, user-scalable=no" />
		<meta itemprop="image" content="http://www.vtourraine.net/blog/img/ios-contacts-twitter-carnet-adresses/contact.jpg">
		
		<!--[if lte IE 8]>
		<script src="../script/html5ie.js" type="text/javascript"></script>
		<![endif]-->
		
		<script type="text/javascript">
		  window.___gcfg = {lang: 'fr'};
		
		  (function() {
		    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
		    po.src = 'https://apis.google.com/js/plusone.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
		  })();
		</script>
		<script type="text/javascript">
		
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-18279263-3']);
		  _gaq.push(['_trackPageview']);
		
		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		
		</script>
	</head>
	<body class="post">
		<header>
			<h1>
				<a class="headline" href="../"><span>Vincent Tourraine</span></a>
				<span id="main"><a href="./"><span class="icon"><img src="../style/img/notepad-28-2x.png" alt="" /></span> <span>Blog</span></a></span>
			</h1>
		</header>
		<section class="post">
			<h1 itemprop="name">iOS : Extraire un compte Twitter du carnet d’adresses</h1>
			<div class="meta"><time datetime="2011-10-18T08:06:45+02:00">18 October 2011</time>, <a class="tag" href="../blog/tags/ios">#iOS</a> <a class="tag" href="../blog/tags/ios-5">#iOS 5</a> <a class="tag" href="../blog/tags/contacts">#Contacts</a> <a class="tag" href="../blog/tags/twitter">#Twitter</a></div>
			<div itemprop="description" class="description">Avec iOS 5, le carnet d’adresses bénéficie de nouveaux champs de saisie pour les réseaux sociaux. <br/>Voyons comment récupérer ces informations.</div>
			<div class="content"><p>
	Le framework <em>AddressBook</em> est une mine d'informations depuis la première version du SDK, et iOS 5 continue d'apporter quelques renseignements intéressants. Soit dit en passant, je suis toujours étonné qu'aucune protection n'existe pour avertir l'utilisateur qu'une application parcourt son carnet d'adresses, comme c'est le cas pour la géolocalisation par exemple, mais ceci est un autre débat.
</p>
<div class="slideshow">
	<img src="img/ios-contacts-twitter-carnet-adresses/contact.jpg" alt="Contact" />
</div>
<p>
	Avec iOS 5, l'utilisateur peut donc renseigner les coordonnées d'une personne pour les principaux réseaux sociaux. Pour autant, l'extraction des données en question n'est ni très simple, ni abondamment documentée.
</p>
<p>
	Le plus intéressant concerne Twitter, grâce à son niveau d'intégration, mais la méthode qui va suivre s'applique également à tous les autres réseaux reconnus : Facebook, Flickr, LinkedIn et MySpace (sic). 
</p>
<h2>Rappels</h2>
<p>
	Le point de départ, c'est un <em>ABRecordRef</em>, qui permet d'identifier une fiche dans le carnet d'adresses. Vous pouvez récupérer cette valeur directement par itération, par recherche, ou bien avec le composant graphique standard <em>ABPeoplePickerNavigationController</em>.
</p>
<p>
	Vous pouvez alors accéder à certaines informations très facilement :
</p>
<code>
		ABRecordRef record = ...;<br/>
    <br/>
    NSString * prenom	= (NSString*)ABRecordCopyValue(record, kABPersonFirstNameProperty);<br/>
    [prenom release];
</code>
<p>
	D'autres un peu moins facilement (notamment lorsque plusieurs valeurs sont possibles) :
</p>
<code>
		ABMutableMultiValueRef telephones = ABRecordCopyValue(record, kABPersonPhoneProperty);<br/>
		CFIndex nbTelephones = ABMultiValueGetCount(telephones);<br/>
		for ( int k=0 ; k&lt;nbTelephones ; k++ ) {<br/>
		&nbsp;&nbsp;NSString * telephone = (NSString*) ABMultiValueCopyValueAtIndex(telephones, k);<br/>
		&nbsp;&nbsp;[telephone release];<br/>
		}<br/>
		CFRelease(telephones);
</code>
<h2>Twitter</h2>
<p>
	Pour les réseaux sociaux, associés à la propriété <em>kABPersonSocialProfileProperty</em>, c'est encore un peu plus compliqué, car chaque entrée correspond à un dictionnaire, avec les informations suivantes :
</p>
<ul>
	<li>
		<em>kABPersonSocialProfileServiceKey</em> : le réseau social concerné
	</li>
	<li>
		<em>kABPersonSocialProfileUsernameKey</em> : le nom d'utilisateur
	</li>
	<li>
		<em>kABPersonSocialProfileUserIdentifierKey</em> : l'identifiant de l'utilisateur (utile pour retrouver avec certitude un compte Facebook, par exemple)
	</li>
	<li>
		<em>kABPersonSocialProfileURLKey</em> : l'URL du profil en question (pour Twitter, il s'agit donc de 'http://www.twitter.com/xxx')
	</li>
</ul>
<p>
	Avec ces constantes, libre à vous de parcourir les données à votre disposition selon ce que vous souhaitez en faire. Voici par exemple une fonction qui retourne le nom du compte Twitter pour la personne passée en paramètre :
</p>
<code>
	- (NSString*)getTwitterUsernameFromRecord:(ABRecordRef)record {<br/>
	&nbsp;&nbsp;NSString * twitterUsername = nil;<br/>
	&nbsp;&nbsp;<br/>
	&nbsp;&nbsp;ABMutableMultiValueRef socials = ABRecordCopyValue(record, kABPersonSocialProfileProperty);<br/>
	&nbsp;&nbsp;CFIndex socialsCount = ABMultiValueGetCount(socials);<br/>
	<br/>
	&nbsp;&nbsp;for (int k=0 ; k&lt;socialsCount ; k++) {<br/>
	&nbsp;&nbsp;&nbsp;&nbsp;CFDictionaryRef socialValue = ABMultiValueCopyValueAtIndex(socials, k);<br/>
	&nbsp;&nbsp;&nbsp;&nbsp;if(CFStringCompare( CFDictionaryGetValue(socialValue, kABPersonSocialProfileServiceKey), kABPersonSocialProfileServiceTwitter, 0)==kCFCompareEqualTo) {<br/>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;twitterUsername = (NSString*) CFDictionaryGetValue(socialValue, kABPersonSocialProfileUsernameKey);<br/>
	&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
	&nbsp;&nbsp;&nbsp;&nbsp;CFRelease(socialValue);<br/>
	        <br/>
	&nbsp;&nbsp;&nbsp;&nbsp;if(twitterUsername)<br/>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br/>
	&nbsp;&nbsp;}<br/>
	&nbsp;&nbsp;CFRelease(socials);<br/>
	    <br/>
	&nbsp;&nbsp;return twitterUsername;<br/>
	}
</code>
<h2>Références</h2>
<ul>
	<li>
		<a href="http://developer.apple.com/library/ios/#documentation/ContactData/Conceptual/AddressBookProgrammingGuideforiPhone/Introduction.html">Address Book Programming Guide for iOS</a>
	<li>
		<a href="http://developer.apple.com/library/ios/#documentation/AddressBook/Reference/ABPersonRef_iPhoneOS/Reference/reference.html">ABPerson Reference</a>
	</li>
</ul></div>
			<div class="share">
				<a href="https://twitter.com/share" class="twitter-share-button" data-text="&quot;iOS : Extraire un compte Twitter du carnet d’adresses&quot; par @vtourraine" data-count="horizontal" data-lang="fr">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
				<div class="g-plusone" data-size="medium" ></div>	
				<a href="https://plus.google.com/u/0/117326560329576507699/posts" class="profile" rel="author me">Google+</a>
			</div>
			<div class="comments">
				<div id="disqus_thread"></div>
				<script type="text/javascript">
				    var disqus_shortname = 'vtourraine';
				
				    (function() {
				        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
				        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
				    })();
				</script>
				<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
				<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
			</div>
		</section>
		
		<section>
			<div>
				<div class="postprevious">
					<a href="http://www.vtourraine.net/blog/ios-retina-resolution-taille-pixel"><span>← Billet précédent</span><br/>iOS, Retina, et le pixel parfait</a>
				</div>
				<div class="postnext">
					<a href="http://www.vtourraine.net/blog/ios-xcode-projets-parallele"><span>Billet suivant →</span><br />Making-of MemO’clock&zwnj;/&zwnj;GeO’clock : Projets parallèles</a>
				</div>
			</div>
		</section>
		<footer>
			<nav>
				<a href="../">Vincent Tourraine</a> / <a href="../projects/">Projets</a> / <a href="./"><span>Blog</span></a>
			</nav>
			<div id="mail">
				<a href="mailto:me@vtourraine.net">me@vtourraine.net</a>
			</div>
		</footer>
	</body>
</html>